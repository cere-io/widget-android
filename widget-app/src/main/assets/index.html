<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#000000">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width shrink-to-fit=no">

    <style>
        html, body, #root {
            min-height: 100% !important;
            height: 100%;
            width: 100%
        }
    </style>

    <script type="text/javascript">
        window.widget = {
          userId: '::userId::',
          appId: '::appId::',
          env: '::env::',
          mode: '::mode::',
          sections: '::sections::'.split(',')
        };

        console.log('Widget data', window.widget);

        var script = document.createElement('script');
        script.src = '::widgetUrl::';
        script.defer = true;
        script.onload = function() {
            console.log('Check JS Bridge', window.WebViewJavascriptBridge);

            var nativeStorage = window.NativeStorage;
            console.log('Check NativeStorage', nativeStorage);

            window.CRBWidget.init({
                uid: window.widget.userId,
                appId: window.widget.appId,
                env: window.widget.env,
                mode: window.widget.mode,
                sections: window.widget.sections,
            });

            window.CRBWidget
                .setMode('login')
                .onSetStorageItem(function(key, value) {
                    return nativeStorage.setItem(key, value)
                        .then(function(data) {
                            var res = null;

                            if (data) {
                                try {
                                    res = JSON.parse(data);
                                } catch (e) {
                                    res = data;
                                }
                            }

                            console.log('WidgetAndroidSDK::setStorageItem result', res);
                            return res;
                        });
                })
                .onGetStorageItem(function(key) {
                    return nativeStorage.getItem(key)
                        .then(function(data) {
                            var res = null;

                            if (data) {
                                try {
                                    res = JSON.parse(data);
                                } catch (e) {
                                    res = data;
                                }
                            }

                            console.log('WidgetAndroidSDK::getStorageItem result', res);
                            return res;
                })
                .show()
                .expand();
            });
        };

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    </script>
</head>
<body>
</body>
</html>